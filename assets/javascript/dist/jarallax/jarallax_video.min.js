((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).jarallaxVideo=t()})(this,function(){var l="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(){this.doneCallbacks=[],this.failCallbacks=[]}var r={autoplay:!(e.prototype={execute(e,t){let o=e.length;for(t=Array.prototype.slice.call(t);o;)e[--o].apply(null,t)},resolve(...e){this.execute(this.doneCallbacks,e)},reject(...e){this.execute(this.failCallbacks,e)},done(e){this.doneCallbacks.push(e)},fail(e){this.failCallbacks.push(e)}}),loop:!1,mute:!1,volume:100,showControls:!0,accessibilityHidden:!1,startTime:0,endTime:0};let s=0,t=0,i=0,o=0,a=0,n=new e,p=new e;class d{constructor(e,t){var o,i,a=this;a.url=e,a.options_default={...r},a.options=(o={},i=[a.options_default,t],o=o||{},Object.keys(i).forEach(t=>{i[t]&&Object.keys(i[t]).forEach(e=>{o[e]=i[t][e]})}),o),a.videoID=a.parseURL(e),a.videoID&&(a.ID=s,s+=1,a.loadAPI(),a.init())}parseURL(i){var e=!(!(e=i.match(/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|shorts\/|watch\?v=)([^#\&\?]*).*/))||11!==e[1].length)&&e[1],t=!(!(t=i.match(/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/))||!t[3])&&t[3],o=(()=>{let e=i.split(/,(?=mp4\:|webm\:|ogv\:|ogg\:)/),t={},o=0;return e.forEach(e=>{e=e.match(/^(mp4|webm|ogv|ogg)\:(.*)/);e&&e[1]&&e[2]&&(t["ogv"===e[1]?"ogg":e[1]]=e[2],o=1)}),!!o&&t})();return e?(this.type="youtube",e):t?(this.type="vimeo",t):!!o&&(this.type="local",o)}isValid(){return!!this.videoID}on(e,t){this.userEventsList=this.userEventsList||[],(this.userEventsList[e]||(this.userEventsList[e]=[])).push(t)}off(o,i){this.userEventsList&&this.userEventsList[o]&&(i?this.userEventsList[o].forEach((e,t)=>{e===i&&(this.userEventsList[o][t]=!1)}):delete this.userEventsList[o])}fire(e,...t){this.userEventsList&&void 0!==this.userEventsList[e]&&this.userEventsList[e].forEach(e=>{e&&e.apply(this,t)})}play(e){let t=this;t.player&&("youtube"===t.type&&t.player.playVideo&&(void 0!==e&&t.player.seekTo(e||0),l.YT.PlayerState.PLAYING!==t.player.getPlayerState())&&t.player.playVideo(),"vimeo"===t.type&&(void 0!==e&&t.player.setCurrentTime(e),t.player.getPaused().then(e=>{e&&t.player.play()})),"local"===t.type)&&(void 0!==e&&(t.player.currentTime=e),t.player.paused)&&t.player.play()}pause(){let t=this;t.player&&("youtube"===t.type&&t.player.pauseVideo&&l.YT.PlayerState.PLAYING===t.player.getPlayerState()&&t.player.pauseVideo(),"vimeo"===t.type&&t.player.getPaused().then(e=>{e||t.player.pause()}),"local"===t.type)&&!t.player.paused&&t.player.pause()}mute(){var e=this;e.player&&("youtube"===e.type&&e.player.mute&&e.player.mute(),"vimeo"===e.type&&e.player.setVolume&&e.setVolume(0),"local"===e.type)&&(e.$video.muted=!0)}unmute(){var e=this;e.player&&("youtube"===e.type&&e.player.mute&&e.player.unMute(),"vimeo"===e.type&&e.player.setVolume&&e.setVolume(e.options.volume||100),"local"===e.type)&&(e.$video.muted=!1)}setVolume(e=!1){var t=this;t.player&&"number"==typeof e&&("youtube"===t.type&&t.player.setVolume&&t.player.setVolume(e),"vimeo"===t.type&&t.player.setVolume&&t.player.setVolume(e/100),"local"===t.type)&&(t.$video.volume=e/100)}getVolume(t){var e=this;e.player?("youtube"===e.type&&e.player.getVolume&&t(e.player.getVolume()),"vimeo"===e.type&&e.player.getVolume&&e.player.getVolume().then(e=>{t(100*e)}),"local"===e.type&&t(100*e.$video.volume)):t(!1)}getMuted(t){var e=this;e.player?("youtube"===e.type&&e.player.isMuted&&t(e.player.isMuted()),"vimeo"===e.type&&e.player.getVolume&&e.player.getVolume().then(e=>{t(!!e)}),"local"===e.type&&t(e.$video.muted)):t(null)}getImageURL(o){let i=this;if(i.videoImage)o(i.videoImage);else{if("youtube"===i.type){let e=["maxresdefault","sddefault","hqdefault","0"],t=0;var a=new Image;a.onload=function(){120!==(this.naturalWidth||this.width)||t===e.length-1?(i.videoImage=`https://img.youtube.com/vi/${i.videoID}/${e[t]}.jpg`,o(i.videoImage)):(t+=1,this.src=`https://img.youtube.com/vi/${i.videoID}/${e[t]}.jpg`)},a.src=`https://img.youtube.com/vi/${i.videoID}/${e[t]}.jpg`}if("vimeo"===i.type){let e=l.innerWidth||1920,t=(l.devicePixelRatio&&(e*=l.devicePixelRatio),e=Math.min(e,1920),new XMLHttpRequest);t.open("GET",`https://vimeo.com/api/oembed.json?url=${i.url}&width=`+e,!0),t.onreadystatechange=function(){var e;4===this.readyState&&200<=this.status&&this.status<400&&(e=JSON.parse(this.responseText)).thumbnail_url&&(i.videoImage=e.thumbnail_url,o(i.videoImage))},t.send(),t=null}}}getIframe(e){this.getVideo(e)}getVideo(t){let a=this;a.$video?t(a.$video):a.onAPIready(()=>{let i;if(a.$video||((i=document.createElement("div")).style.display="none"),"youtube"===a.type){let t,o;a.playerOptions={host:"https://www.youtube-nocookie.com",videoId:a.videoID,playerVars:{autohide:1,rel:0,autoplay:0,playsinline:1}},a.options.showControls||(a.playerOptions.playerVars.iv_load_policy=3,a.playerOptions.playerVars.modestbranding=1,a.playerOptions.playerVars.controls=0,a.playerOptions.playerVars.showinfo=0,a.playerOptions.playerVars.disablekb=1),a.playerOptions.events={onReady(t){if(a.options.mute?t.target.mute():"number"==typeof a.options.volume&&t.target.setVolume(a.options.volume),a.options.autoplay&&a.play(a.options.startTime),a.fire("ready",t),a.options.loop&&!a.options.endTime)a.options.endTime=a.player.getDuration()-.1;setInterval(()=>{a.getVolume(e=>{a.options.volume!==e&&(a.options.volume=e,a.fire("volumechange",t))})},150)},onStateChange(e){a.options.loop&&e.data===l.YT.PlayerState.ENDED&&a.play(a.options.startTime),t||e.data!==l.YT.PlayerState.PLAYING||(t=1,a.fire("started",e)),e.data===l.YT.PlayerState.PLAYING&&a.fire("play",e),e.data===l.YT.PlayerState.PAUSED&&a.fire("pause",e),e.data===l.YT.PlayerState.ENDED&&a.fire("ended",e),e.data===l.YT.PlayerState.PLAYING?o=setInterval(()=>{a.fire("timeupdate",e),a.options.endTime&&a.player.getCurrentTime()>=a.options.endTime&&(a.options.loop?a.play(a.options.startTime):a.pause())},150):clearInterval(o)},onError(e){a.fire("error",e)}};var e=!a.$video;if(e){let e=document.createElement("div");e.setAttribute("id",a.playerID),i.appendChild(e),document.body.appendChild(i)}a.player=a.player||new l.YT.Player(a.playerID,a.playerOptions),e&&(a.$video=document.getElementById(a.playerID),a.options.accessibilityHidden&&(a.$video.setAttribute("tabindex","-1"),a.$video.setAttribute("aria-hidden","true")),a.videoWidth=parseInt(a.$video.getAttribute("width"),10)||1280,a.videoHeight=parseInt(a.$video.getAttribute("height"),10)||720)}if("vimeo"===a.type){if(a.playerOptions={dnt:1,id:a.videoID,autopause:0,transparent:0,autoplay:a.options.autoplay?1:0,loop:a.options.loop?1:0,muted:a.options.mute||0===a.options.volume?1:0},a.options.showControls||(a.playerOptions.controls=0),!a.options.showControls&&a.options.loop&&a.options.autoplay&&(a.playerOptions.background=1),!a.$video){let t="";Object.keys(a.playerOptions).forEach(e=>{""!==t&&(t+="&"),t+=e+"="+encodeURIComponent(a.playerOptions[e])}),a.$video=document.createElement("iframe"),a.$video.setAttribute("id",a.playerID),a.$video.setAttribute("src",`https://player.vimeo.com/video/${a.videoID}?`+t),a.$video.setAttribute("frameborder","0"),a.$video.setAttribute("mozallowfullscreen",""),a.$video.setAttribute("allowfullscreen",""),a.$video.setAttribute("title","Vimeo video player"),a.options.accessibilityHidden&&(a.$video.setAttribute("tabindex","-1"),a.$video.setAttribute("aria-hidden","true")),i.appendChild(a.$video),document.body.appendChild(i)}let t;a.player=a.player||new l.Vimeo.Player(a.$video,a.playerOptions),a.options.mute||"number"!=typeof a.options.volume||a.setVolume(a.options.volume),a.options.startTime&&a.options.autoplay&&a.player.setCurrentTime(a.options.startTime),a.player.getVideoWidth().then(e=>{a.videoWidth=e||1280}),a.player.getVideoHeight().then(e=>{a.videoHeight=e||720}),a.player.on("timeupdate",e=>{t||(a.fire("started",e),t=1),a.fire("timeupdate",e),a.options.endTime&&e.seconds>=a.options.endTime&&(a.options.loop?a.play(a.options.startTime):a.pause())}),a.player.on("play",e=>{a.fire("play",e),a.options.startTime&&0===e.seconds&&a.play(a.options.startTime)}),a.player.on("pause",e=>{a.fire("pause",e)}),a.player.on("ended",e=>{a.fire("ended",e)}),a.player.on("loaded",e=>{a.fire("ready",e)}),a.player.on("volumechange",e=>{a.getVolume(e=>{a.options.volume=e}),a.fire("volumechange",e)}),a.player.on("error",e=>{a.fire("error",e)})}if("local"===a.type){let t;a.$video||(a.$video=document.createElement("video"),a.player=a.$video,a.options.showControls&&(a.$video.controls=!0),"number"==typeof a.options.volume&&a.setVolume(a.options.volume),a.options.mute&&a.mute(),a.options.loop&&(a.$video.loop=!0),a.$video.setAttribute("playsinline",""),a.$video.setAttribute("webkit-playsinline",""),a.options.accessibilityHidden&&(a.$video.setAttribute("tabindex","-1"),a.$video.setAttribute("aria-hidden","true")),a.$video.setAttribute("id",a.playerID),i.appendChild(a.$video),document.body.appendChild(i),Object.keys(a.videoID).forEach(e=>{var t,o,i;t=a.$video,o=a.videoID[e],e="video/"+e,(i=document.createElement("source")).src=o,i.type=e,t.appendChild(i)})),a.player.addEventListener("playing",e=>{t||a.fire("started",e),t=1}),a.player.addEventListener("timeupdate",function(e){a.fire("timeupdate",e),a.options.endTime&&this.currentTime>=a.options.endTime&&(a.options.loop?a.play(a.options.startTime):a.pause())}),a.player.addEventListener("play",e=>{a.fire("play",e)}),a.player.addEventListener("pause",e=>{a.fire("pause",e)}),a.player.addEventListener("ended",e=>{a.fire("ended",e)}),a.player.addEventListener("loadedmetadata",function(){a.videoWidth=this.videoWidth||1280,a.videoHeight=this.videoHeight||720,a.fire("ready"),a.options.autoplay&&a.play(a.options.startTime)}),a.player.addEventListener("volumechange",e=>{a.getVolume(e=>{a.options.volume=e}),a.fire("volumechange",e)}),a.player.addEventListener("error",e=>{a.fire("error",e)})}t(a.$video)})}init(){this.playerID="VideoWorker-"+this.ID}loadAPI(){if(!t||!i){let o="";if("youtube"!==this.type||t||(t=1,o="https://www.youtube.com/iframe_api"),"vimeo"===this.type&&!i){if(i=1,void 0!==l.Vimeo)return;o="https://player.vimeo.com/api/player.js"}if(o){let e=document.createElement("script"),t=document.getElementsByTagName("head")[0];e.src=o,t.appendChild(e),t=null,e=null}}}onAPIready(t){let e=this;if("youtube"===e.type&&(void 0!==l.YT&&0!==l.YT.loaded||o?"object"==typeof l.YT&&1===l.YT.loaded?t():n.done(()=>{t()}):(o=1,l.onYouTubeIframeAPIReady=function(){l.onYouTubeIframeAPIReady=null,n.resolve("done"),t()})),"vimeo"===e.type)if(void 0!==l.Vimeo||a)void 0!==l.Vimeo?t():p.done(()=>{t()});else{a=1;let e=setInterval(()=>{void 0!==l.Vimeo&&(clearInterval(e),p.resolve("done"),t())},20)}"local"===e.type&&t()}}var u,y="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function m(r=y.jarallax){if(void 0!==r){let e=r.constructor,t=e.prototype.onScroll,o=(e.prototype.onScroll=function(){let o=this;t.apply(o),o.isVideoInserted||!o.video||o.options.videoLazyLoading&&!o.isElementInViewport||o.options.disableVideo()||(o.isVideoInserted=!0,o.video.getVideo(e=>{var t=e.parentNode;o.css(e,{position:o.image.position,top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",pointerEvents:"none",transformStyle:"preserve-3d",backfaceVisibility:"hidden",margin:0,zIndex:-1}),o.$video=e,"local"===o.video.type&&(o.image.src?o.$video.setAttribute("poster",o.image.src):o.image.$item&&"IMG"===o.image.$item.tagName&&o.image.$item.src&&o.$video.setAttribute("poster",o.image.$item.src)),o.options.videoClass&&o.$video.setAttribute("class",`${o.options.videoClass} ${o.options.videoClass}-`+o.video.type),o.image.$container.appendChild(e),t.parentNode.removeChild(t),o.options.onVideoInsert&&o.options.onVideoInsert.call(o)}))},e.prototype.coverImage),i=(e.prototype.coverImage=function(){var a=this,l=o.apply(a),r=!!a.image.$item&&a.image.$item.nodeName;if(l&&a.video&&r&&("IFRAME"===r||"VIDEO"===r)){let e=l.image.height,t=e*a.image.width/a.image.height,o=(l.container.width-t)/2,i=l.image.marginTop;l.container.width>t&&(t=l.container.width,e=t*a.image.height/a.image.width,o=0,i+=(l.image.height-e)/2),"IFRAME"===r&&(e+=400,i-=200),a.css(a.$video,{width:t+"px",marginLeft:o+"px",height:e+"px",marginTop:i+"px"})}return l},e.prototype.initImg),a=(e.prototype.initImg=function(){var e=this,t=i.apply(e);return e.options.videoSrc||(e.options.videoSrc=e.$item.getAttribute("data-jarallax-video")||null),e.options.videoSrc?(e.defaultInitImgResult=t,!0):t},e.prototype.canInitParallax),l=(e.prototype.canInitParallax=function(){let o=this,e=a.apply(o);if(o.options.videoSrc){let t=new d(o.options.videoSrc,{autoplay:!0,loop:o.options.videoLoop,showControls:!1,accessibilityHidden:!0,startTime:o.options.videoStartTime||0,endTime:o.options.videoEndTime||0,mute:!o.options.videoVolume,volume:o.options.videoVolume||0});if(o.options.onVideoWorkerInit&&o.options.onVideoWorkerInit.call(o,t),t.isValid())if(this.options.disableParallax()&&(e=!0,o.image.position="absolute",o.options.type="scroll",o.options.speed=1),e){if(t.on("ready",()=>{if(o.options.videoPlayOnlyVisible){let e=o.onScroll;o.onScroll=function(){e.apply(o),o.videoError||!o.options.videoLoop&&(o.options.videoLoop,o.videoEnded)||(o.isVisible()?t.play():t.pause())}}else t.play()}),t.on("started",()=>{o.image.$default_item=o.image.$item,o.image.$item=o.$video,o.image.width=o.video.videoWidth||1280,o.image.height=o.video.videoHeight||720,o.coverImage(),o.onScroll(),o.image.$default_item&&(o.image.$default_item.style.display="none")}),t.on("ended",()=>{o.videoEnded=!0,o.options.videoLoop||i()}),t.on("error",()=>{o.videoError=!0,i()}),o.video=t,!o.defaultInitImgResult&&(o.image.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","local"!==t.type))return t.getImageURL(e=>{o.image.bgImage=`url("${e}")`,o.init()}),!1}else o.defaultInitImgResult||t.getImageURL(e=>{var t=o.$item.getAttribute("style");t&&o.$item.setAttribute("data-jarallax-original-styles",t),o.css(o.$item,{"background-image":`url("${e}")`,"background-position":"center","background-size":"cover"})});function i(){o.image.$default_item&&(o.image.$item=o.image.$default_item,o.image.$item.style.display="block",o.coverImage(),o.onScroll())}}return e},e.prototype.destroy);e.prototype.destroy=function(){var e=this;e.image.$default_item&&(e.image.$item=e.image.$default_item,delete e.image.$default_item),l.apply(e)}}}return m(),u=()=>{void 0!==y.jarallax&&y.jarallax(document.querySelectorAll("[data-jarallax-video]"))},"complete"===document.readyState||"interactive"===document.readyState?u():document.addEventListener("DOMContentLoaded",u,{capture:!0,once:!0,passive:!0}),y.VideoWorker||(y.VideoWorker=d),m});
//# sourceMappingURL=jarallax_video.min.js.map
